{% extends 'storage_base.html' %}

{%block tab_header %}
  ZFS dataset/volume replication
{%endblock%}

{% block inside_content %}

  {% if not dataset %} 
    <table class="table " style="width:800px">
      <tr>
        <td>Select a dataset of replication </td>
        <td>
          <select id="id_datasets" class="form-control"> 
            {% for dataset in datasets %}
              <option id="{{dataset}}">{{dataset}}</option>
            {% endfor %}
          </select>
        </td>
      </tr>
    </table>
    <button class="btn btn-primary btn-sm" id="replication_status">Change replication status </button>
  {%else %}
    <form class="form-horizontal" role="form" name="schedule_replication" action="" method="post">
      <table  class="table " style="width:800px">
        <tr>
          <th> Replication Status</th>
          <td> 
            <strong>{{replication_status|title}}  </strong>
            <input type="text"  name="replication_status" class="form-control" id="id_replication_status" placeholder="Replication Status" value="{{replication_status}}" style="display:none;"> 
          </td>
        </tr>
        <tr>
          <th> Destination pool name</th>
          <td>
            <input type="text"  name="dest_pool" class="form-control" id="id_dest_pool" placeholder="Destination Pool Name" value="{{dest}}" required> 
          </td>
        </tr>
        <tr>
          <th> Destination IP</th>
          <td>
            <input type="text"  name="ip" class="form-control" id="id_dest_ip" placeholder="Destination IP" value="{{ip}}" required> 
          </td>
        </tr>
        <tr>
          <th> Selected Dataset</th>
          <td>
            <input type="text"  name="dataset" class="form-control" id="id_dataset" placeholder="{{dataset}}" value="{{dataset}}" readonly > 
          </td>
        </tr>
        <tr>
          <th> Schedule </th>
          <td>
            <div id="scheduler"></div>
          </td>
        </tr>
      </table>
      <input type="text"  name="action" class="form-control" id="id_action" readonly style="display:none;"> 
      <div class="btn-group btn-group-sm" role="group" aria-label="...">
        <a href="/view_remote_replications" role="button" class="btn btn-default"> Cancel</a>
        {% if "disabled" in replication_status %}
          <button type="submit" class="btn btn-primary" id="start">Start Replication</button>
        {% else %}
          <button type="submit" class="btn btn-info" id="update">Update Replication</button>
          <button type="submit" class="btn btn-danger" id="stop">Stop Replication</button>
        {% endif %}
      </div>
    </form>
  {% endif %}

{%endblock%}

{%block help_header%}
  Replicate ZFS datasets
{%endblock%}

{%block help_body%}
{%endblock%}

{% block tab_active %}
  <script>
   make_tab_active("view_remote_replications_tab")
   $(".btn").click(function(){
	  $("#id_action").val(this.id)
	})
  </script>
  <script>
    $("#replication_status").click(function(){
      window.location = "/replicate_zfs_dataset/?dataset_name="+$("#id_datasets option:selected").text() 
   });
  </script>
{% endblock %}

{% block js %}

  <script type="text/javascript" src="/static/js/jquery-cron-min.js"></script>
  <link type="text/css" href="/static/css/jquery-cron.css" rel="stylesheet" />
  <script>
    $('#scheduler').cron();
  </script>
{% endblock %}
